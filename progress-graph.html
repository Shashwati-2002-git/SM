<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Progress Graphs</title>
  <link rel="stylesheet" href="styles/header.css">
  <link rel="stylesheet" href="styles/progress-graph.css">
  <link rel="stylesheet" href="styles/footer.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- Header -->
  <div id="header"></div>

  <main class="progress-container">
    <!-- Left Sidebar -->
    <aside class="sidebar">
      <h3>Progress Quiz Taken</h3>
      <button onclick="loadGraph('general')">General</button>
      <button onclick="loadGraph('depression')">Depression</button>
      <button onclick="loadGraph('ocd')">OCD</button>
      <button onclick="loadGraph('adhd')">ADHD</button>
      <button onclick="loadGraph('anxiety')">Anxiety</button>
    </aside>

    <!-- Graph Section -->
    <section class="graph-section">
      <h2>Progress Graph</h2>
      <canvas id="progressChart"></canvas>
    </section>
  </main>

  <!-- Footer -->
  <div id="footer"></div>

  <script src="header.js" defer></script>
  <script src="progress-graphs.js"></script>

  <script>
    async function loadComponent(id, file) {
        const res = await fetch(file);
        document.getElementById(id).innerHTML = await res.text();

        // If header loaded, attach header.js
        if (id === "header") {
        const script = document.createElement("script");
        script.src = "header.js";
        script.onload = () => {
            if (window.updateHeader) window.updateHeader();
        };
        document.body.appendChild(script);
        }
    }

    loadComponent("header", "header.html");
    loadComponent("footer", "footer.html");
    const ctx = document.getElementById("progressChart").getContext("2d");

    // Generate random data
    function generateData() {
    const dates = ["01 Sep", "05 Sep", "10 Sep", "15 Sep", "20 Sep", "25 Sep"];
    return {
        labels: dates,
        scores: dates.map(() => Math.floor(Math.random() * 100))
    };
    }

    let chart;

    // Initialize default chart
    function initChart() {
    const { labels, scores } = generateData();
    chart = new Chart(ctx, {
        type: "line",
        data: {
        labels: labels,
        datasets: [{
            label: "Score",
            data: scores,
            borderColor: "#7b4ed4",
            backgroundColor: "rgba(123, 78, 212, 0.2)",
            tension: 0.3,
            fill: true,
            pointRadius: 5,
            pointBackgroundColor: "#5a3ea1"
        }]
        },
        options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
            min: 0,
            max: 100,
            ticks: { stepSize: 20 }
            }
        }
        }
    });
    }

    // Load new graph when button clicked
    function loadGraph(type) {
    const { labels, scores } = generateData();
    chart.data.labels = labels;
    chart.data.datasets[0].data = scores;
    chart.data.datasets[0].label = `${type.charAt(0).toUpperCase() + type.slice(1)} Progress`;
    chart.update();
    }

    // Initialize chart on load
    initChart();
  </script>
</body>
</html>
